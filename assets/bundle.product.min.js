window.REBASE=window.REBASE||{},REBASE.theme=REBASE.theme||{},document.addEventListener("DOMContentLoaded",(function(){var t,e=$(".product-option--bundle.product-option--selected input");if(REBASE.theme.product_photo_gallery=new Swiper(".gallery.swiper-container",{effect:"slide",loop:!0,speed:300,slidesPerView:1.25,centeredSlides:!0,spaceBetween:20,navigation:{nextEl:".swiper__button--next",prevEl:".swiper__button--prev"},thumbs:{swiper:REBASE.theme.product_photo_thumbs},breakpoints:{960:{slidesPerView:1,centeredSlides:!1,spaceBetween:0}}}),$(document).on("click",".thumbs .thumbs__item",(function(){REBASE.theme.product_photo_gallery.slideToLoop($(this).data("index"))})),product=new REBASE.theme.Product({$container:$("#add-to-cart-form")}),product.currentVariant?(t=product.currentVariant.option1.split("+"),$(".product-option").removeClass("product-option--selected"),$('.product-option--bundle input[value="'+product.currentVariant.option3+'"]').click(),t.forEach((function(t){$('.product-option--flavor input[value="'+t.trim()+'"]').click()}))):e.click(),$(".sold-in-number")&&$("#add-to-cart-form")){var n=$("#add-to-cart-form").data("productid"),i=localStorage.getItem(n+"SoldIn");i||(i=Math.floor(71*Math.random()+150),localStorage.setItem(n+"SoldIn",i)),$(".sold-in-number").html(i)}})),REBASE.theme.Product=function(){function t(t){this.variants=null,this.$container=t.$container,this.data=JSON.parse(document.getElementById("product__json").innerHTML),this.currentVariant=JSON.parse(document.getElementById("current_variant__json").innerHTML),this.variantDefaults=JSON.parse(document.getElementById("variant__defaults").innerHTML),this.variantPerBagPrices=JSON.parse(document.getElementById("variant_per_bag").innerHTML),console.log(this.variantPerBagPrices),this.settings={single_option_selector:".single-option-select",original_select_id:"select#product-select"},this.data?this._initVariants():console&&console.log("Missing product json data!")}return t.prototype=$.extend({},t.prototype,{_initVariants:function(){var t={$container:this.$container,enable_history_state:!0,single_option_selector:this.settings.single_option_selector,original_select_id:this.settings.original_select_id,product:this.data};this.variants=new REBASE.theme.Variants(t),this.$container.on("variantChange",this._updateAddToCart.bind(this)),this.$container.on("variantChange",this._updatePrices.bind(this)),this.$container.on("optionChange",this._updateSelectedOption.bind(this))},_setSlashPrice:function(t){var e=t.compare_at_price||"",n=t.compare_at_price||"",i=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2});t.price==t.compare_at_price&&(e=""),0!==e.length&&(e=i.format(.01*e)),0!==n.length&&(n=i.format(.01*n)),$("#slash_price_one_time").text(e),$("#slash_price_subscription").text(n)},_setPricesInBundles:function(){function t(){$(".rc_block__type__onetime").hasClass("rc_block__type--active")?($(".product-option--selected .per-bag--once").css("display","block"),$(".product-option--selected .per-bag--subs").css("display","none")):$(".rc_block__type__autodeliver").hasClass("rc_block__type--active")&&($(".product-option--selected .per-bag--subs").css("display","block"),$(".product-option--selected .per-bag--once").css("display","none"))}t(),$(".rc_block").click((function(){t()}))},_setPerBagPrices:function(t){var e=this.variantPerBagPrices[t];$(".per-bag--once").html(e.once),$(".per-bag--subs").html(e.subs)},_getSelectedBundleLimit:function(){return $(".product-option--bundle.product-option--selected input").data("flavor-limit")},_getSelectedFlavorCount:function(){return $(".product-option--flavor.product-option--selected").length},_setFlavorsForBundle:function(t){$(".product-option--flavor").removeClass("product-option--selected"),defaultFlavors=this.variantDefaults[t].split("|"),defaultFlavors.forEach((function(t){$('.product-option--flavor input[value="'+t+'"]').click()}))},_getDisabledButtonLabel:function(t){switch(t){case 1:return"Select 2nd Flavor";case 2:return"Select 3rd Flavor";case 3:return"Select 4th Flavor"}},_updateBundleOption:function(t){$(".product-option--bundle").removeClass("product-option--selected"),$('.product-option--bundle input[value="'+t+'"]').parents(".product-option").addClass("product-option--selected")},_updateFlavorOption:function(t){var e=this._getSelectedBundleLimit(),n=this._getSelectedFlavorCount();n<e&&$('.product-option--flavor input[value="'+t+'"]').parents(".product-option").addClass("product-option--selected"),n>=e&&($(".product-option--flavor").removeClass("product-option--selected"),$('.product-option--flavor input[value="'+t+'"]').parents(".product-option").addClass("product-option--selected"))},_updateSelectedOption:function(t){var e=t.target.dataset.type,n=t.target.value;"bundle"==e?(this._updateBundleOption(n),this._setFlavorsForBundle(n)):"flavor"==e&&this._updateFlavorOption(n)},_updatePrices:function(t){t.variant&&(this._setSlashPrice(t.variant),this._setPerBagPrices(t.variant.id),this._setPricesInBundles())},_updateAddToCart:function(t){var e=$("#add-to-cart"),n=$("#add-to-cart-text"),i=this._getSelectedBundleLimit(),o=this._getSelectedFlavorCount(),r=n.data("add-to-cart-text");!t.variant||i>o?(r=this._getDisabledButtonLabel(o),e.addClass("disabled"),$(".product-option--flavor.product-option--selected").length<=0&&(r="Sold Out")):e.removeClass("disabled"),n.text(r)}}),t}(),REBASE.theme.Variants=function(){function t(t){this.$container=t.$container,this.product=t.product,this.single_option_selector=t.single_option_selector,this.original_select_id=t.original_select_id,this.enable_history_state=t.enable_history_state,this.variantFlavorLimits=JSON.parse(document.getElementById("variant__flavor_limits").innerHTML),this.current_variant={},$(this.single_option_selector,this.$container).on("click",this._onOptionChange.bind(this))}return t.prototype=$.extend({},t.prototype,{_getCurrentSelections:function(){return $.map($(this.single_option_selector,this.$container),(function(t){var e={};return!!$(t).parents(".product-option--selected").length&&(e.value=t.value,e.type=t.dataset.type,e)})).filter(Boolean)},_getVariantFromOptions:function(){var t,e=this._getCurrentOptions(),n=this.product.variants;return{variant_match:t=(t=$.grep(n,(function(t){return e.every((function(e){return t[e.index]===e.value}))}))).length?t[0]:void 0}},_getSelectedBundle:function(){return $('input[name="single-option-select-bundle"]:checked').val()},_getFlavorLimit:function(t){return this.variantFlavorLimits[t]},_getSelectedVariant:function(){var t=this._getCurrentSelections(),e=[],n=null,i=!1,o=t.filter((function(t){return"bundle"===t.type}))[0],r=t.filter((function(t){return"flavor"===t.type}));switch(o.value){case"variety":var a=Math.min($(".product-options--flavors .product-option").length,this._getFlavorLimit(o.value));i=r.length===a;break;case"bundle":case"single":case"single-sm":i=r.length===this._getFlavorLimit(o.value)}return i&&(e=(e=this.product.variants.filter((function(t){return t.option3===o.value}))).filter((function(t){var e=!0;return r.forEach((function(n){t.option1.includes(n.value)||(e=!1)})),e}))).length>0&&(n=e[0]),n},_onOptionChange:function(t){var e,n=this._getSelectedBundle();this.$container.trigger({type:"optionChange",target:t.target,selected_bundle:n}),e=this._getSelectedVariant(),this._variantChange(e),e?(this._updateMasterSelect(e),this._updatePrice(e),this.current_variant=e,this.enable_history_state&&this._updateHistoryState(e)):this.current_variant={}},_variantChange:function(t){this.$container.trigger({type:"variantChange",variant:t})},_updatePrice:function(t){t.price===this.current_variant.price&&t.compare_at_price===this.current_variant.compare_at_price||this.$container.trigger({type:"variantPriceChange",variant:t})},_updateHistoryState:function(t){if(history.replaceState&&t){var e=new URLSearchParams(window.location.search);e.set("variant",t.id);var n=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+e.toString();window.history.replaceState({path:n},"",n)}},_updateMasterSelect:function(t){$(this.original_select_id,this.$container).val(t.id)}}),t}();